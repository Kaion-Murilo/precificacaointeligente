@model precificacaointeligente.Models.PrecificacaoModel
@{
    ViewData["Title"] = "Sistema de Precificação Inteligente";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        background: linear-gradient(135deg, #f4f6f8, #e5eaf4);
        font-family: 'Segoe UI', sans-serif;
        color: #2d2d2d;
    }

    }

    h1, h4 {
        font-weight: 700;
    }

    /* ======= CARD PRINCIPAL ======= */
    .main-card {
        border-radius: 18px;
        box-shadow: 0 6px 25px rgba(0,0,0,0.1);
        padding: 2.5rem;
        transition: all 0.3s ease;
    }

        .main-card:hover {
            transform: scale(1.01);
        }

    /* ======= FORMULÁRIO ======= */
    label {
        color: #0d6efd;
        font-weight: 600;
    }

    .form-control {
        border-radius: 10px;
        padding: 0.75rem;
        border: 1.5px solid #cbd3da;
        transition: 0.3s;
    }

        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.15rem rgba(13,110,253,.25);
        }

    .input-percent {
        position: relative;
    }

        .input-percent input {
            padding-right: 2rem;
        }

        .input-percent span {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-weight: 600;
        }

    /* ======= BOTÃO ======= */
    .btn-gradient {
        background: linear-gradient(135deg, #0d6efd, #00bfa6);
        border: none;
        color: white;
        font-weight: 600;
        font-size: 1.1rem;
        padding: 0.9rem;
        border-radius: 12px;
        transition: 0.3s;
    }

        .btn-gradient:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

    /* ======= RESULTADOS ======= */
    .results-section h4 {
        color: #0d6efd;
        font-weight: 700;
    }

    .result-card {
        border-radius: 14px;
        transition: transform 0.3s;
    }

        .result-card:hover {
            transform: translateY(-5px);
        }

    canvas {
        background: white;
        border-radius: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* ======= SEÇÃO DE CÁLCULOS ======= */
    .calc-steps {
        background: #f8fafc;
        border-left: 5px solid #0d6efd;
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2.5rem;
        box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }

        .calc-steps h5 {
            color: #0d6efd;
            font-weight: 600;
        }

        .calc-steps code {
            background: #eef3ff;
            color: #333;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            display: inline-block;
            margin: 0.3rem 0;
        }

</style>

<!-- ======= CABEÇALHO BONITO ======= -->
<div class="titulo-container text-center my-5 p-5 shadow-sm rounded-4">
    <h1 class="display-5 fw-bold mb-3">
        💼 Sistema de <span class="text-gradient">Precificação Inteligente</span>
    </h1>
    <p class="lead text-secondary fw-semibold">
        Calcule preços, lucros e pontos de equilíbrio com base em equações lineares e otimização real.
    </p>
</div>

<style>
    /* ======= TÍTULO BONITO ======= */
    .titulo-container {
        background: linear-gradient(135deg, #ffffff, #f0f7ff);
        border: 2px solid #e1ecff;
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
    }

        .titulo-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
        }

    .text-gradient {
        background: linear-gradient(135deg, #0d6efd, #00bfa6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .titulo-container h1 {
        font-size: 2.5rem;
    }

    .titulo-container p {
        color: #4a4a4a;
        font-size: 1.1rem;
    }
</style>


<div class="container">
    <div class="main-card mx-auto" style="max-width: 850px;">
        <form asp-action="Index" method="post" class="row g-3">
            <div class="col-md-6">
                <label class="form-label">Custo Fixo (R$)</label>
                <input asp-for="CustoFixo" type="number" step="0.01" min="0" class="form-control" placeholder="Ex: 5000" required />
            </div>

            <div class="col-md-6">
                <label class="form-label">Custo Variável por Unidade (R$)</label>
                <input asp-for="CustoVariavel" type="number" step="0.01" min="0" class="form-control" placeholder="Ex: 20" required />
            </div>

            <div class="col-md-6">
                <label class="form-label">Preço de Venda (R$)</label>
                <input asp-for="PrecoVenda" type="number" step="0.01" min="0" class="form-control" placeholder="Ex: 45" required />
            </div>

            <div class="col-md-6">
                <label class="form-label">Quantidade Estimada</label>
                <input asp-for="Quantidade" type="number" step="1" min="1" class="form-control" placeholder="Ex: 1000" required />
            </div>

            <div class="col-md-6 input-percent">
                <label class="form-label">Margem de Lucro Desejada</label>
                <input asp-for="MargemLucro" type="number" step="0.01" min="0" max="100" class="form-control" placeholder="Ex: 25" required />
            </div>

            <div class="col-12 mt-4">
                <button type="submit" class="btn btn-gradient w-100 shadow-sm">
                    💡 Calcular
                </button>
            </div>
        </form>
    </div>

    @if (ViewBag.Resultado != null)
    {
        var r = ViewBag.Resultado;

        <div class="results-section mt-5">
            <h4 class="text-center mb-4">📊 Resultados</h4>
            <div class="row text-center g-3">
                <div class="col-md-4">
                    <div class="card result-card bg-light p-3 shadow-sm">
                        <h5>Lucro Total</h5>
                        <p class="fs-4 fw-bold text-success">R$ @r.Lucro.ToString("F2")</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card result-card bg-light p-3 shadow-sm">
                        <h5>Ponto de Equilíbrio</h5>
                        <p class="fs-4 fw-bold text-primary">@r.PontoEquilibrio.ToString("F0") unidades</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card result-card bg-light p-3 shadow-sm">
                        <h5>Preço Ideal</h5>
                        <p class="fs-4 fw-bold text-warning">R$ @r.PrecoIdeal.ToString("F2")</p>
                    </div>
                </div>
            </div>

            <div class="calc-steps mt-5">
                <h5>🧮 Cálculos Passo a Passo</h5>

                <!-- NOVO BLOCO: EQUAÇÃO LINEAR DO LUCRO -->
                <hr />
                <h5>📐 Equação Linear do Lucro</h5>

                <p>
                    A relação entre o <strong>Lucro (L)</strong> e a <strong>Quantidade (Q)</strong> é uma
                    <span class="text-primary fw-bold">equação linear de 1º grau</span>, pois segue o formato:
                </p>

                <div class="p-3 bg-light border rounded-3 shadow-sm mb-3 text-center">
                    <code style="font-size:1.2rem; color:#0d6efd;">
                        L = (PV - CV) × Q - CF
                    </code>
                    <br />
                    <small class="text-muted">
                        onde:<br />
                        L = Lucro total<br />
                        PV = Preço de venda (R$)<br />
                        CV = Custo variável por unidade (R$)<br />
                        Q = Quantidade produzida<br />
                        CF = Custo fixo (R$)
                    </small>
                </div>

                <p><strong>🔹 Substituindo os valores informados:</strong></p>

                <code>L = (@r.PrecoVenda - @r.CustoVariavel) × @r.Quantidade - @r.CustoFixo</code><br />
                <code>L = (@(r.PrecoVenda - r.CustoVariavel)) × @r.Quantidade - @r.CustoFixo</code><br />
                <code>L = R$ @(((r.PrecoVenda - r.CustoVariavel) * r.Quantidade - r.CustoFixo).ToString("F2"))</code>


                <p class="mt-3">
                    Essa expressão mostra que o lucro cresce de forma <strong>proporcional à quantidade</strong>,
                    com taxa de crescimento igual a <code>(PV - CV)</code>. O termo <code>-CF</code> representa o custo fixo inicial.
                </p>

                <div class="alert alert-info mt-3">
                    💡 <strong>Interpretação:</strong> A equação <code>L = (PV - CV)Q - CF</code> é linear (1º grau).
                    Ela forma uma reta no gráfico, e o ponto onde <code>L = 0</code> representa o <strong>ponto de equilíbrio</strong>.
                </div>
                <hr />

                <p><strong>1️⃣ Lucro Total:</strong></p>
                <code>Lucro = (Preço de Venda - Custo Variável) × Quantidade - Custo Fixo</code><br />
                <code>Lucro = (@r.PrecoVenda - @r.CustoVariavel) × @r.Quantidade - @r.CustoFixo</code><br />
                <code>Lucro = R$ @(((r.PrecoVenda - r.CustoVariavel) * r.Quantidade - r.CustoFixo).ToString("F2"))</code>

                <hr />

                <p><strong>2️⃣ Ponto de Equilíbrio:</strong></p>
                <code>Ponto de Equilíbrio = Custo Fixo ÷ (Preço de Venda - Custo Variável)</code><br />
                <code>Ponto de Equilíbrio = @r.CustoFixo ÷ (@r.PrecoVenda - @r.CustoVariavel)</code><br />
                <code>Ponto de Equilíbrio = @r.PontoEquilibrio.ToString("F2") unidades</code>

                <hr />

                <p><strong>3️⃣ Preço Ideal (com Margem Desejada):</strong></p>
                <code>Preço Ideal = Custo Variável ÷ (1 - Margem de Lucro/100)</code><br />
                <code>Preço Ideal = @r.CustoVariavel ÷ (1 - @r.MargemLucro/100)</code><br />
                <code>Preço Ideal = R$ @r.PrecoIdeal.ToString("F2")</code>
            </div>

            <div class="mt-5">
                <canvas id="graficoLucro" height="120"></canvas>
            </div>

            <script>
                const ctx = document.getElementById('graficoLucro').getContext('2d');
                const data = {
                    labels: [...Array(21).keys()].map(i => i * 10),
                    datasets: [
                        {
                            label: 'Receita Total',
                            data: [...Array(21).keys()].map(i => (i * 10) * @r.PrecoVenda),
                            borderColor: '#00bfa6',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Custo Total',
                            data: [...Array(21).keys()].map(i => @r.CustoFixo + (i * 10 * @r.CustoVariavel)),
                            borderColor: '#dc3545',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: false
                        }
                    ]
                };

                new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: '📈 Receita x Custo Total' }
                        },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            </script>
        </div>


    }
</div>